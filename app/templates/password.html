<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Change Password - CollaboLearn</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Link to your custom CSS file. Ensure this path is correct. -->
    <link rel="stylesheet" href="{{ url_for('static', filename='style/password.css') }}">
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="logo">
            <i class="fas fa-graduation-cap"></i>
            <h1>CollaboLearn</h1>
        </div>
        <!-- Link back to the appropriate dashboard based on user role -->
        {# You might want to dynamically set this based on session.role #}
        {# For now, linking to student_dashboard as a common fallback #}
        <a href="{{ url_for('main.student_dashboard') }}" class="nav-link">‚Üê Back to Dashboard</a>
    </nav>

    {# Flash Messages Container - Placed outside the main content container for full-width display #}
    <div class="flash-message-container">
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="flash-message {{ category }}">
                        {{ message }}
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}
    </div>

    <main class="profile-container single-column"> {# Using 'single-column' for a simpler layout #}
        <!-- Change Password Form -->
        <section class="profile-form"> {# Reusing profile-form class for consistent styling #}
            <h3>Change Your Password</h3>

            <form method="POST" action="{{ url_for('main.password') }}" class="space-y-4">
                {# The 'change_password' route in routes.py already handles the logic for current, new, and confirm passwords #}
                <div>
                    <label for="current_password">
                        Current Password
                        <input type="password" name="current_password" id="current_password"
                               placeholder="Enter your current password" required />
                    </label>
                </div>

                <div>
                    <label for="new_password">
                        New Password
                        <input type="password" name="new_password" id="new_password"
                               placeholder="Enter your new password" required minlength="6" />
                    </label>
                </div>

                <div>
                    <label for="confirm_password">
                        Confirm New Password
                        <input type="password" name="confirm_password" id="confirm_password"
                               placeholder="Confirm your new password" required minlength="6" />
                    </label>
                </div>

                <div>
                    <button type="submit" class="btn-primary update-btn">
                        Update Password
                    </button>
                </div>
            </form>
        </section>
    </main>
    <!-- Include this script at the bottom of your password.html template -->
<script>
document.addEventListener('DOMContentLoaded', () => {
    const flashMessages = document.querySelectorAll('.flash-message');

    flashMessages.forEach(msg => {
        // Create toast container if it doesn't exist
        let toastContainer = document.querySelector('.toast-container');
        if (!toastContainer) {
            toastContainer = document.createElement('div');
            toastContainer.className = 'toast-container';
            document.body.appendChild(toastContainer);
        }

        // Clone the flash message into a toast
        const toast = document.createElement('div');
        toast.className = `toast ${msg.classList.contains('success') ? 'toast-success' : 'toast-error'}`;
        toast.textContent = msg.textContent;

        // Clear form fields if success toast is shown
if (msg.classList.contains('success')) {
    const form = document.querySelector('form');
    if (form) form.reset();
}


        // Append and animate
        toastContainer.appendChild(toast);
        setTimeout(() => toast.classList.add('show'), 100);

        // Auto-dismiss after 4 seconds
        setTimeout(() => {
            toast.classList.remove('show');
            setTimeout(() => toast.remove(), 300);
        }, 4000);
    });
});
</script>
</body>
</html>
