<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manage Course - {{ course.title }}</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .fade-in {
            animation: fadeIn 0.5s;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .flash-message {
            animation: fadeIn 0.5s, fadeOut 0.5s 4.5s;
            animation-fill-mode: forwards;
        }
        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }
    </style>
</head> 
<body>
   {% extends 'base.html' %}
   {% block title %}Manage Course - {{ course.title }}{% endblock %}
   {% block head %}
     <meta charset="UTF-8">
     <meta name="viewport" content="width=device-width, initial-scale=1.0">
   {% endblock %}
   {% block content %}
   <div class="min-h-screen bg-gray-50">
     <!-- Flash Messages -->
     <div class="fixed top-4 right-4 z-50 space-y-2">
       {% with messages = get_flashed_messages(with_categories=true) %}
         {% if messages %}
           {% for category, message in messages %}
             <div class="flash-message px-4 py-3 rounded-md shadow-lg {% if category == 'error' %}bg-red-100 text-red-800 border border-red-200{% elif category == 'success' %}bg-green-100 text-green-800 border border-green-200{% elif category == 'warning' %}bg-yellow-100 text-yellow-800 border border-yellow-200{% elif category == 'info' %}bg-blue-100 text-blue-800 border border-blue-200{% else %}bg-blue-100 text-blue-800 border border-blue-200{% endif %}">
               <div class="flex items-center">
                 {% if category == 'error' %}<i class="fas fa-exclamation-circle mr-2"></i>{% endif %}
                 {% if category == 'success' %}<i class="fas fa-check-circle mr-2"></i>{% endif %}
                 {% if category == 'warning' %}<i class="fas fa-exclamation-triangle mr-2"></i>{% endif %}
                 {% if category == 'info' %}<i class="fas fa-info-circle mr-2"></i>{% endif %}
                 {{ message }}
               </div>
             </div>
           {% endfor %}
         {% endif %}
       {% endwith %}
     </div>

     <div class="max-w-7xl mx-auto px-4 py-8">
       <!-- Course Header -->
       <div class="bg-white rounded-xl shadow-md overflow-hidden mb-8">
         <div class="bg-gradient-to-r from-indigo-600 to-purple-600 p-6 text-white">
           <div class="flex flex-col md:flex-row justify-between items-start md:items-center">
             <div>
               <h1 class="text-3xl font-bold mb-2">{{ course.title }}</h1>
               <p class="text-indigo-100">{{ course.description }}</p>
             </div>
             <div class="mt-4 md:mt-0 flex space-x-2">
               <a href="{{ url_for('main.instructor_dashboard') }}" class="bg-white bg-opacity-20 hover:bg-opacity-30 text-white px-4 py-2 rounded-lg transition flex items-center">
                 <i class="fas fa-arrow-left mr-2"></i>Back to Dashboard
               </a>
               <button onclick="toggleEditCourse()" class="bg-white bg-opacity-20 hover:bg-opacity-30 text-white px-4 py-2 rounded-lg transition flex items-center">
                 <i class="fas fa-edit mr-2"></i>Edit Course
               </button>
             </div>
           </div>
         </div>
         
         <div class="p-6 grid grid-cols-1 md:grid-cols-3 gap-4">
           <div class="bg-indigo-50 p-4 rounded-lg">
             <div class="flex items-center">
               <div class="p-3 rounded-full bg-indigo-100 text-indigo-600">
                 <i class="fas fa-calendar-alt text-xl"></i>
               </div>
               <div class="ml-4">
                 <p class="text-sm text-gray-500">Created Date</p>
                 <p class="text-lg font-semibold text-gray-800">{{ course.created_at.strftime('%Y-%m-%d') if course.created_at else 'N/A' }}</p>
               </div>
             </div>
           </div>
           
           <div class="bg-green-50 p-4 rounded-lg">
             <div class="flex items-center">
               <div class="p-3 rounded-full bg-green-100 text-green-600">
                 <i class="fas fa-users text-xl"></i>
               </div>
               <div class="ml-4">
                 <p class="text-sm text-gray-500">Enrolled Students</p>
                 <p class="text-lg font-semibold text-gray-800">{{ enrolled_students|length }}</p>
               </div>
             </div>
           </div>
           
           <div class="bg-purple-50 p-4 rounded-lg">
             <div class="flex items-center">
               <div class="p-3 rounded-full bg-purple-100 text-purple-600">
                 <i class="fas fa-tasks text-xl"></i>
               </div>
               <div class="ml-4">
                 <p class="text-sm text-gray-500">Assignments</p>
                 <p class="text-lg font-semibold text-gray-800">{{ assignments|length if assignments else 0 }}</p>
               </div>
             </div>
           </div>
         </div>
       </div>
       
       <!-- Edit Course Form (Hidden by default) -->
       <div id="edit-course-form" class="bg-white rounded-xl shadow-md p-6 mb-8 hidden">
         <h2 class="text-xl font-semibold text-gray-800 mb-4 flex items-center">
           <i class="fas fa-edit mr-2 text-indigo-600"></i>Edit Course Details
         </h2>
         <form method="POST" action="{{ url_for('main.edit_course', course_id=course.id) }}" enctype="multipart/form-data">
           <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
             <div>
               <label for="title" class="block text-sm font-medium text-gray-700 mb-1">Course Title</label>
               <input type="text" id="title" name="title" value="{{ course.title }}" required
                 class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
             </div>
             
             <div>
               <label for="materials" class="block text-sm font-medium text-gray-700 mb-1">Course Materials</label>
               <input type="file" id="materials" name="materials"
                 class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
               {% if course.materials %}
                 <p class="mt-1 text-sm text-gray-500">Current file: {{ course.materials }}</p>
               {% endif %}
             </div>
           </div>
           
           <div class="mt-4">
             <label for="description" class="block text-sm font-medium text-gray-700 mb-1">Course Description</label>
             <textarea id="description" name="description" rows="4" required
               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">{{ course.description }}</textarea>
           </div>
           
           <div class="mt-6 flex justify-end space-x-3">
             <button type="button" onclick="toggleEditCourse()" 
               class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
               Cancel
             </button>
             <button type="submit" 
               class="px-4 py-2 border border-transparent rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
               Save Changes
             </button>
           </div>
         </form>
       </div>
       
       <!-- Tabs Navigation -->
       <div class="bg-white rounded-xl shadow-md overflow-hidden">
         <div class="border-b border-gray-200">
           <nav class="flex -mb-px">
             <button onclick="openTab(event, 'students-tab')" class="tab-button py-4 px-6 text-center border-b-2 border-indigo-500 font-medium text-sm text-indigo-600 focus:outline-none">
               <i class="fas fa-users mr-2"></i>Students
             </button>
             <button onclick="openTab(event, 'assignments-tab')" class="tab-button py-4 px-6 text-center border-b-2 border-transparent font-medium text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300 focus:outline-none">
               <i class="fas fa-tasks mr-2"></i>Assignments
             </button>
             <button onclick="openTab(event, 'materials-tab')" class="tab-button py-4 px-6 text-center border-b-2 border-transparent font-medium text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300 focus:outline-none">
               <i class="fas fa-book mr-2"></i>Materials
             </button>
           </nav>
         </div>
         
         <!-- Tab Contents -->
         <div class="p-6">
           <!-- Students Tab -->
           <div id="students-tab" class="tab-content active fade-in">
             <div class="flex justify-between items-center mb-4">
               <h2 class="text-xl font-semibold text-gray-800">Enrolled Students</h2>
               <div class="flex space-x-2">
                 <div class="relative">
                   <input type="text" id="student-search" placeholder="Search students..." 
                     class="pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                   <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
                 </div>
                 <button onclick="syncEnrollments({{ course.id }})" class="bg-indigo-600 text-white px-4 py-2 rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 flex items-center">
                   <i class="fas fa-sync mr-2"></i>Sync Enrollments
                 </button>
               </div>
             </div>
             
             {% if enrolled_students %}
               <div class="overflow-x-auto">
                 <table class="min-w-full divide-y divide-gray-200">
                   <thead class="bg-gray-50">
                     <tr>
                       <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Student</th>
                       <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Email</th>
                       <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Progress</th>
                     </tr>
                   </thead>
                   <tbody class="bg-white divide-y divide-gray-200">
                     {% for student in enrolled_students %}
                       <tr class="student-row hover:bg-gray-50" data-student-name="{{ student.full_name|lower }}">
                         <td class="px-6 py-4 whitespace-nowrap">
                           <div class="flex items-center">
                             <div class="h-10 w-10 flex-shrink-0">
                               <div class="h-10 w-10 rounded-full bg-indigo-100 flex items-center justify-center">
                                 <span class="text-indigo-800 font-medium">{{ student.full_name|first|upper }}</span>
                               </div>
                             </div>
                             <div class="ml-4">
                               <div class="text-sm font-medium text-gray-900">{{ student.full_name }}</div>
                             </div>
                           </div>
                         </td>
                         <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ student.email }}</td>
                         <td class="px-6 py-4 whitespace-nowrap">
                           <div class="flex items-center">
                             <div class="h-2 w-full bg-gray-200 rounded-full overflow-hidden">
                               <div class="h-full bg-green-500 rounded-full" style="width: {{ student.progress|default(0) }}%"></div>
                             </div>
                             <span class="ml-2 text-sm text-gray-600">{{ student.progress|default(0) }}%</span>
                           </div>
                         </td>
                       </tr>
                     {% endfor %}
                   </tbody>
                 </table>
               </div>
             {% else %}
               <div class="text-center py-8">
                 <i class="fas fa-user-slash text-gray-300 text-4xl mb-4"></i>
                 <h3 class="text-lg font-medium text-gray-900 mb-1">No students in the system</h3>
                 <p class="text-gray-500">There are no students in the system yet.</p>
               </div>
             {% endif %}
           </div>
           
           <!-- Assignments Tab -->
           <div id="assignments-tab" class="tab-content">
             <div class="flex justify-between items-center mb-4">
               <h2 class="text-xl font-semibold text-gray-800">Course Assignments</h2>
               <a href="{{ url_for('main.add_assignments', course_id=course.id) }}" class="bg-indigo-600 text-white px-4 py-2 rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 flex items-center">
                 <i class="fas fa-plus mr-2"></i>Add Assignment
               </a>
             </div>
             
             {% if assignments %}
               <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                 {% for assignment in assignments %}
                   <div class="bg-white border border-gray-200 rounded-lg shadow-sm overflow-hidden hover:shadow-md transition-shadow">
                     <div class="p-4">
                       <div class="flex justify-between">
                         <h3 class="text-lg font-medium text-gray-900">{{ assignment.title }}</h3>
                         <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium 
                           {% if assignment.status == 'active' %}bg-green-100 text-green-800{% elif assignment.status == 'pending' %}bg-yellow-100 text-yellow-800{% else %}bg-gray-100 text-gray-800{% endif %}">
                           {{ assignment.status|title }}
                         </span>
                       </div>
                       <p class="mt-2 text-sm text-gray-600">{{ assignment.description }}</p>
                       <div class="mt-4 flex justify-between items-center">
                         <div class="text-sm text-gray-500">
                           <i class="far fa-calendar-alt mr-1"></i>Due: {{ assignment.due_date.strftime('%Y-%m-%d') }}
                         </div>
                         <div class="flex space-x-2">
                           <a href="{{ url_for('main.edit_assignment', assignment_id=assignment.id) }}" class="text-indigo-600 hover:text-indigo-900">
                             <i class="fas fa-edit"></i>
                           </a>
                           <a href="{{ url_for('main.view_submissions', assignment_id=assignment.id) }}" class="text-green-600 hover:text-green-900">
                             <i class="fas fa-eye"></i>
                           </a>
                         </div>
                       </div>
                     </div>
                   </div>
                 {% endfor %}
               </div>
             {% else %}
               <div class="text-center py-8">
                 <i class="fas fa-tasks text-gray-300 text-4xl mb-4"></i>
                 <h3 class="text-lg font-medium text-gray-900 mb-1">No assignments yet</h3>
                 <p class="text-gray-500 mb-4">Create assignments to assess student learning.</p>
                 <a href="{{ url_for('main.add_assignments', course_id=course.id) }}" class="bg-indigo-600 text-white px-4 py-2 rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 flex items-center mx-auto">
                   <i class="fas fa-plus mr-2"></i>Add Assignment
                 </a>
               </div>
             {% endif %}
           </div>
           
           <!-- Materials Tab -->
           <div id="materials-tab" class="tab-content">
             <div class="flex justify-between items-center mb-4">
               <h2 class="text-xl font-semibold text-gray-800">Course Materials</h2>
               <button onclick="showAddMaterialModal()" class="bg-indigo-600 text-white px-4 py-2 rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 flex items-center">
                 <i class="fas fa-plus mr-2"></i>Add Material
               </button>
             </div>
             
             {% if course.materials %}
               <div class="bg-white border border-gray-200 rounded-lg shadow-sm overflow-hidden">
                 <div class="p-6">
                   <div class="flex items-center justify-between">
                     <div>
                       <h3 class="text-lg font-medium text-gray-900">Course Materials</h3>
                       <p class="mt-1 text-sm text-gray-500">Download or update course materials</p>
                     </div>
                     <a href="{{ url_for('static', filename='uploads/' ~ course.materials) }}" 
                        class="bg-indigo-600 text-white px-4 py-2 rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 flex items-center">
                       <i class="fas fa-download mr-2"></i>Download
                     </a>
                   </div>
                 </div>
               </div>
             {% else %}
               <div class="text-center py-8">
                 <i class="fas fa-book text-gray-300 text-4xl mb-4"></i>
                 <h3 class="text-lg font-medium text-gray-900 mb-1">No course materials</h3>
                 <p class="text-gray-500 mb-4">Upload materials to support student learning.</p>
                 <button onclick="showAddMaterialModal()" class="bg-indigo-600 text-white px-4 py-2 rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 flex items-center mx-auto">
                   <i class="fas fa-plus mr-2"></i>Add Material
                 </button>
               </div>
             {% endif %}
           </div>
         </div>
       </div>
     </div>
     
     <!-- Add Material Modal -->
     <div id="add-material-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden">
       <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white">
         <div class="mt-3">
           <div class="flex items-center justify-between mb-4">
             <h3 class="text-lg font-medium text-gray-900">Update Course Materials</h3>
             <button onclick="hideAddMaterialModal()" class="text-gray-400 hover:text-gray-500">
               <i class="fas fa-times"></i>
             </button>
           </div>
           
           <form method="POST" action="{{ url_for('main.update_course_materials', course_id=course.id) }}" enctype="multipart/form-data">
             <div class="mb-4">
               <label for="materials" class="block text-sm font-medium text-gray-700 mb-1">Course Materials</label>
               <input type="file" id="materials" name="materials" required
                 class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
             </div>
             
             <div class="flex justify-end space-x-3">
               <button type="button" onclick="hideAddMaterialModal()" 
                 class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                 Cancel
               </button>
               <button type="submit" 
                 class="px-4 py-2 border border-transparent rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                 Upload
               </button>
             </div>
           </form>
         </div>
       </div>
     </div>
   </div>
   
   <script>
     // Tab functionality
     function openTab(evt, tabName) {
       var i, tabcontent, tablinks;
       tabcontent = document.getElementsByClassName("tab-content");
       for (i = 0; i < tabcontent.length; i++) {
         tabcontent[i].classList.remove("active");
       }
       tablinks = document.getElementsByClassName("tab-button");
       for (i = 0; i < tablinks.length; i++) {
         tablinks[i].classList.remove("border-indigo-500", "text-indigo-600");
         tablinks[i].classList.add("border-transparent", "text-gray-500");
       }
       document.getElementById(tabName).classList.add("active");
       evt.currentTarget.classList.remove("border-transparent", "text-gray-500");
       evt.currentTarget.classList.add("border-indigo-500", "text-indigo-600");
     }
     
     // Edit course functionality
     function toggleEditCourse() {
       const form = document.getElementById('edit-course-form');
       form.classList.toggle('hidden');
     }
     
     // Student search functionality
     document.addEventListener('DOMContentLoaded', function() {
       const searchInput = document.getElementById('student-search');
       if (searchInput) {
         searchInput.addEventListener('input', function() {
           const searchTerm = this.value.toLowerCase();
           const studentRows = document.querySelectorAll('.student-row');
           
           studentRows.forEach(row => {
             const studentName = row.getAttribute('data-student-name');
             if (studentName.includes(searchTerm)) {
               row.style.display = '';
             } else {
               row.style.display = 'none';
             }
           });
         });
       }
     });
     
     // Modal functionality
     function showAddMaterialModal() {
       document.getElementById('add-material-modal').classList.remove('hidden');
     }
     
     function hideAddMaterialModal() {
       document.getElementById('add-material-modal').classList.add('hidden');
     }
     
     // Sync enrollments functionality
     function syncEnrollments(courseId) {
       if (confirm('Are you sure you want to sync enrollments for this course? This will enroll all students in the system.')) {
         const form = document.createElement('form');
         form.method = 'POST';
         form.action = `/sync_enrollments/${courseId}`;
         document.body.appendChild(form);
         form.submit();
       }
     }
   </script>
   {% endblock %}
</body>
</html>