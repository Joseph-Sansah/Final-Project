<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Forums | CollaboLearn Student Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest"></script>
  <style>
    .forum-card { transition: all 0.3s ease; }
    .forum-card:hover { transform: translateY(-2px); box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); }
    .fade-in { animation: fadeIn 0.5s; }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    .tab-content { display: none; }
    .tab-content.active { display: block; }
  </style>
</head>
<body class="bg-gray-50 text-gray-900">
  <!-- Header -->
  <header class="bg-gradient-to-r from-blue-800 to-indigo-900 text-white shadow-lg">
    <div class="max-w-6xl mx-auto px-6 py-6">
      <div class="flex flex-col md:flex-row md:items-center md:justify-between">
        <div>
          <div class="flex items-center gap-3 mb-2">
            <i data-lucide="message-circle" class="w-6 h-6"></i>
            <h1 class="text-2xl font-bold">CollaboLearn Forums</h1>
          </div>
          <p class="text-blue-200">Student Dashboard</p>
        </div>
        <div class="mt-4 md:mt-0">
          <a href="{{ url_for('main.student_dashboard') }}" class="inline-flex items-center gap-2 bg-white bg-opacity-20 hover:bg-opacity-30 px-4 py-2 rounded-lg transition">
            <i data-lucide="arrow-left" class="w-4 h-4"></i>
            <span>Back to Dashboard</span>
          </a>
        </div>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="max-w-6xl mx-auto px-6 py-8">
    <!-- Page Header -->
    <section class="mb-8 fade-in">
      <h2 class="text-3xl font-bold text-gray-800 mb-2">Instructor Forums</h2>
      <p class="text-gray-600">Access and participate in forums created by your instructors</p>
    </section>

    <!-- Tabs for Recent and Past Forums -->
    <div class="bg-white rounded-xl shadow-md mb-6">
      <div class="border-b border-gray-200">
        <nav class="flex -mb-px">
          <button class="tab-btn py-4 px-6 text-center border-b-2 border-blue-500 font-medium text-blue-600" data-tab="recent">
            <div class="flex items-center gap-2">
              <i data-lucide="clock" class="w-4 h-4"></i>
              <span>Recent Forums</span>
            </div>
          </button>
          <button class="tab-btn py-4 px-6 text-center border-b-2 border-transparent font-medium text-gray-500 hover:text-gray-700" data-tab="past">
            <div class="flex items-center gap-2">
              <i data-lucide="archive" class="w-4 h-4"></i>
              <span>Past Forums</span>
            </div>
          </button>
        </nav>
      </div>

      <!-- Recent Forums Tab -->
      <div id="recent" class="tab-content active p-6">
        {% if recent_forums %}
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            {% for forum in recent_forums %}
              <div class="forum-card bg-white border border-gray-200 rounded-xl overflow-hidden">
                <div class="p-5">
                  <div class="flex justify-between items-start mb-3">
                    <span class="bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full">{{ forum.course_title or "General" }}</span>
                  </div>
                  
                  <h3 class="font-bold text-lg text-gray-800 mb-2">{{ forum.title }}</h3>
                  <p class="text-gray-600 text-sm mb-4 line-clamp-2">{{ forum.description }}</p>
                  
                  <div class="flex flex-wrap gap-3 text-xs text-gray-500 mb-4">
                    <div class="flex items-center gap-1">
                      <i data-lucide="calendar" class="w-3 h-3"></i>
                      <span>{{ forum.created_at.strftime('%b %d, %Y') }}</span>
                    </div>
                    <div class="flex items-center gap-1">
                      <i data-lucide="user" class="w-3 h-3"></i>
                      <span>{{ forum.instructor_name }}</span>
                    </div>
                    <div class="flex items-center gap-1">
                      <i data-lucide="message-circle" class="w-3 h-3"></i>
                      <span>{{ forum.total_replies }} replies</span>
                    </div>
                  </div>
                  
                  <div class="flex justify-between items-center">
                    {% if forum.avg_rating %}
                      <div class="flex items-center gap-1">
                        <div class="flex">
                          {% for i in range(1, 6) %}
                            {% if i <= forum.avg_rating|round|int %}
                              <i data-lucide="star" class="w-3 h-3 text-amber-500 fill-current"></i>
                            {% else %}
                              <i data-lucide="star" class="w-3 h-3 text-gray-300"></i>
                            {% endif %}
                          {% endfor %}
                        </div>
                        <span class="text-xs text-gray-600">{{ "%.1f"|format(forum.avg_rating) }}</span>
                      </div>
                    {% else %}
                      <span class="text-xs text-gray-500">No ratings yet</span>
                    {% endif %}
                    
                    <a href="{{ url_for('main.forum_detail', forum_id=forum.id) }}" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm font-medium flex items-center gap-1 transition">
                      View
                      <i data-lucide="arrow-right" class="w-3 h-3"></i>
                    </a>
                  </div>
                </div>
              </div>
            {% endfor %}
          </div>
        {% else %}
          <div class="text-center py-12">
            <div class="inline-block p-4 bg-blue-100 rounded-full mb-4">
              <i data-lucide="message-circle-x" class="w-12 h-12 text-blue-600"></i>
            </div>
            <h3 class="text-xl font-medium text-gray-800 mb-2">No recent forums</h3>
            <p class="text-gray-600 max-w-md mx-auto">There are no recent forums available at the moment.</p>
          </div>
        {% endif %}
      </div>

      <!-- Past Forums Tab -->
      <div id="past" class="tab-content p-6">
        {% if past_forums %}
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            {% for forum in past_forums %}
              <div class="forum-card bg-white border border-gray-200 rounded-xl overflow-hidden opacity-90">
                <div class="p-5">
                  <div class="flex justify-between items-start mb-3">
                    <span class="bg-gray-100 text-gray-800 text-xs px-2 py-1 rounded-full">{{ forum.course_title or "General" }}</span>
                    <span class="bg-gray-200 text-gray-700 text-xs px-2 py-1 rounded-full">Archived</span>
                  </div>
                  
                  <h3 class="font-bold text-lg text-gray-800 mb-2">{{ forum.title }}</h3>
                  <p class="text-gray-600 text-sm mb-4 line-clamp-2">{{ forum.description }}</p>
                  
                  <div class="flex flex-wrap gap-3 text-xs text-gray-500 mb-4">
                    <div class="flex items-center gap-1">
                      <i data-lucide="calendar" class="w-3 h-3"></i>
                      <span>{{ forum.created_at.strftime('%b %d, %Y') }}</span>
                    </div>
                    <div class="flex items-center gap-1">
                      <i data-lucide="user" class="w-3 h-3"></i>
                      <span>{{ forum.instructor_name }}</span>
                    </div>
                    <div class="flex items-center gap-1">
                      <i data-lucide="message-circle" class="w-3 h-3"></i>
                      <span>{{ forum.total_replies }} replies</span>
                    </div>
                  </div>
                  
                  <div class="flex justify-between items-center">
                    {% if forum.avg_rating %}
                      <div class="flex items-center gap-1">
                        <div class="flex">
                          {% for i in range(1, 6) %}
                            {% if i <= forum.avg_rating|round|int %}
                              <i data-lucide="star" class="w-3 h-3 text-amber-500 fill-current"></i>
                            {% else %}
                              <i data-lucide="star" class="w-3 h-3 text-gray-300"></i>
                            {% endif %}
                          {% endfor %}
                        </div>
                        <span class="text-xs text-gray-600">{{ "%.1f"|format(forum.avg_rating) }}</span>
                      </div>
                    {% else %}
                      <span class="text-xs text-gray-500">No ratings</span>
                    {% endif %}
                    
                    <a href="{{ url_for('main.forum_detail', forum_id=forum.id) }}" class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg text-sm font-medium flex items-center gap-1 transition">
                      View
                      <i data-lucide="arrow-right" class="w-3 h-3"></i>
                    </a>
                  </div>
                </div>
              </div>
            {% endfor %}
          </div>
        {% else %}
          <div class="text-center py-12">
            <div class="inline-block p-4 bg-gray-100 rounded-full mb-4">
              <i data-lucide="archive" class="w-12 h-12 text-gray-600"></i>
            </div>
            <h3 class="text-xl font-medium text-gray-800 mb-2">No past forums</h3>
            <p class="text-gray-600 max-w-md mx-auto">There are no archived forums available.</p>
          </div>
        {% endif %}
      </div>
    </div>

    <!-- Forum Statistics -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
      <div class="bg-white rounded-xl shadow-md p-6">
        <div class="flex items-center gap-4">
          <div class="p-3 bg-blue-100 rounded-lg">
            <i data-lucide="message-circle" class="w-6 h-6 text-blue-600"></i>
          </div>
          <div>
            <p class="text-sm text-gray-600">Total Forums</p>
            <p class="text-2xl font-bold text-gray-800">{{ total_forums }}</p>
          </div>
        </div>
      </div>
      
      <div class="bg-white rounded-xl shadow-md p-6">
        <div class="flex items-center gap-4">
          <div class="p-3 bg-green-100 rounded-lg">
            <i data-lucide="message-square" class="w-6 h-6 text-green-600"></i>
          </div>
          <div>
            <p class="text-sm text-gray-600">Your Contributions</p>
            <p class="text-2xl font-bold text-gray-800">{{ user_replies }}</p>
          </div>
        </div>
      </div>
      
      <div class="bg-white rounded-xl shadow-md p-6">
        <div class="flex items-center gap-4">
          <div class="p-3 bg-amber-100 rounded-lg">
            <i data-lucide="star" class="w-6 h-6 text-amber-600"></i>
          </div>
          <div>
            <p class="text-sm text-gray-600">Your Average Rating</p>
            <p class="text-2xl font-bold text-gray-800">{{ "%.1f"|format(user_avg_rating) if user_avg_rating else "N/A" }}</p>
          </div>
        </div>
      </div>
    </div>
  </main>

  <script>
    // Initialize Lucide icons
    lucide.createIcons();
    
    // Tab functionality
    document.querySelectorAll('.tab-btn').forEach(button => {
      button.addEventListener('click', () => {
        // Get tab name
        const tabName = button.getAttribute('data-tab');
        
        // Update button styles
        document.querySelectorAll('.tab-btn').forEach(btn => {
          btn.classList.remove('border-blue-500', 'text-blue-600');
          btn.classList.add('border-transparent', 'text-gray-500');
        });
        button.classList.remove('border-transparent', 'text-gray-500');
        button.classList.add('border-blue-500', 'text-blue-600');
        
        // Update tab content visibility
        document.querySelectorAll('.tab-content').forEach(content => {
          content.classList.remove('active');
        });
        document.getElementById(tabName).classList.add('active');
      });
    });
  </script>
</body>
</html>