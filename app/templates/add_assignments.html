<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CollaboLearn | Manage Assignments</title>

  <!-- Styles & Icons -->
  <link rel="stylesheet" href="{{ url_for('static', filename='style/add_assignments.css') }}">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

</head>

<body>
  <!-- Navbar -->
  <nav class="navbar">
    <div class="nav-content">
      <!-- Left -->
      <div class="nav-left">
        <a href="{{ url_for('main.instructor_dashboard') }}">
          <i class="fas fa-home"></i> Dashboard
        </a>
      </div>
    </div>
  </nav>

  <main class="main-container">

    <!-- Flash Messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <div class="flash-messages">
          {% for category, message in messages %}
            <div class="alert {{ category }}">
              <i class="fas fa-info-circle"></i> {{ message }}
            </div>
          {% endfor %}
        </div>
      {% endif %}
    {% endwith %}

    <!-- Add Assignment -->
    <section class="card animate-slide-in">
      <h2 class="section-title">ðŸ“š Add New Assignment</h2>
      <form method="POST" action="{{ url_for('main.add_assignments') }}" enctype="multipart/form-data" class="assignment-form">
        
        <!-- Title -->
        <label for="title">Assignment Title</label>
        <input type="text" id="title" name="title" placeholder="Enter assignment title" required>

        <!-- Description -->
        <label for="description">Description</label>
        <textarea id="description" name="description" rows="4" placeholder="Enter instructions, details, or questions" required></textarea>

        <!-- Grid: Due Date + File -->
        <div class="form-grid">
          <div>
            <label for="due_date">Due Date</label>
            <input type="date" id="due_date" name="due_date" required>
          </div>
          <div>
            <label for="file">Upload File (Optional)</label>
            <input type="file" id="file" name="file">
          </div>
        </div>

        <!-- Submit -->
        <button type="submit" class="btn btn-primary">
          <i class="fas fa-plus-circle"></i> Add Assignment
        </button>
      </form>
    </section>

    <!-- Current Assignments -->
    <section class="card animate-fade-in">
      <h3 class="section-title">ðŸ“¥ Current Assignments</h3>

      {% if assignments %}
        <ul class="assignment-list">
          {% for assignment in assignments %}
            <li class="assignment-item">
              <!-- Info -->
              <div class="assignment-info">
                <strong>{{ assignment.title }}</strong>
                <p class="description">{{ assignment.description }}</p>
                <small class="due">ðŸ“… Due: {{ assignment.due_date }}</small><br>
                {% if assignment.file_url %}
                  <a href="{{ assignment.file_url }}" target="_blank" class="file-link">
                    <i class="fas fa-paperclip"></i> View File
                  </a>
                {% else %}
                  <em class="no-file">No file uploaded</em>
                {% endif %}
              </div>
              <!-- Actions -->
              <div class="assignment-actions">
                <form method="POST" action="{{ url_for('main.delete_assignment', assignment_id=assignment.id) }}"
                      onsubmit="return confirm('Are you sure you want to delete this assignment?');">
                  <button type="submit" class="btn btn-danger">
                    <i class="fas fa-trash-alt"></i> Delete
                  </button>
                </form>
              </div>
            </li>
          {% endfor %}
        </ul>
      {% else %}
        <p class="no-assignments">No assignments added yet.</p>
      {% endif %}
    </section>
  </main>

  <!-- Scripts -->
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const form = document.querySelector(".assignment-form");
      form.addEventListener("submit", () => {
        const btn = form.querySelector("button");
        if (btn) {
          btn.disabled = true;
          btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Submitting...';
        }
      });
    });
  </script>
</body>
</html>
